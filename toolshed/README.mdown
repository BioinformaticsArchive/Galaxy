modENCODE-DCC: Galaxy - ToolShed
===================================

Documentation:
-----------------------

This directory stores Galaxy toolshed files for different packages put together by modDENCODE DCC group. Please send your questions and comments to modENCODE DCC at help@modencode.org


Two folders are located in this directory: dependencies and tools. Due to the mechanism of installing package with or without dependencies through Galaxy Tool Shed, we have had this hierarchy structure to improve management in the future. As a result, these two folders contains different type of files and have different purposes. Dependencies folder stores necessary archived files that will be used during the installation of packages that require dependencies, and tools folder contains the files that are uploaded to Galaxy tool Shed for every users to download to their local Galaxy machines.     


Folder Description:
-----------------------

**Dependencies Folder:**

When you navigate to the folder, you will see 5 subfolders. They are:

>	1. bamedit       ->  samtoolspkg.tar
>	2. macs          ->  macs.tar.bz2
>	3. macs2         ->  macs2pkg.tar
>	4. peakranger    ->  peakranger.tar
>	5. spp           ->  spp_1.10.1.tar.gz

Each folder contains one compressed file (.tar, .tar.gz, or .tar.bz2) which will be used later on during package installation through Galaxy ToolShed. Those archived filed can be accessed/downloaded by typing the URLs:

>	https://github.com/modENCODE-DCC/Galaxy/blob/b1/toolshed/dependencies/bamedit/samtoolspkg.tar?raw=true (Example)

Adding "?raw=true" at the end telling GitHub server that you would like to download the specific files, and this is the way that we use to tell Galaxy ToolShed where to grab the archived files from. 


**Tools Folder:**

The files in this folder are uploaded to Galaxy ToolShed. When you navigate to the folder, you will see one additional package folder: idr. The rest are all the same as in dependencies folder. In each package folder, you will see three main types of files: 

>	1. axxb.py     (example)
>	2. axxb.xml    (example)
>	3. tool_dependencies.xml 

Depend on packages, there might be other files (or scripts) with different functionalities located in package folders. Those external scripts will be used by axxb.xml above to perform calculation. With that being said, let's look into what exactly those three main type of files are.

*axxb.xml:*

>	It servers as an applicatin page on Galaxy. When you are on Galaxy and navigate yourself to the left hand side of the vertical tool bar where you can see all the packages that you have installed. This axxb.xml is the application page that allow you to choose which dataset, information, parameters and so on to execute your experiments.

*axxb.py:*

>	It is a wrapper script which will take parameters passed from axxb.xml and execute commands on the cluster nodes and return the results.

*tool_dependencies.xml:*

>	This is the file which will be parsed by Galaxy program. Galaxy has its own parser to handle whatever files that are named "tool_dependencies.xml". Information in the file includes whether packages have dependencies to install, whether you need to set environment variable, whether it requires moving different files to specific directory and so on. The link below provides a good understanding to what a tool_dependencies.xml parser can do and some essential knowledge of syntax.

>	http://galaxy-central.readthedocs.org/en/latest/_modules/galaxy/tool_shed/tool_dependencies/install_util.html 

Tips:
-----------

There are a few things to notice while coding tool_dependencies.xml.

>	1. It is important to set system PATH and/or PYTHONPATH in tool_dependencies.xml. It will generate the env.sh file in corresponding directory. Some good examples are, for exmaple, peakranger, MACS2, or bamedit.
>
> 	2. Always make sure that the name and version of the packages specified in the package tag in tool_dependencies.xml files are the same as the one in requirement tag in axxb.xml files. ToolShed will complain if they don't match.
>
>	3. If axxb.py uses files (Ex. genome_tables) that are bundled with a package in the tools directory, in another words, there are some codes that will access the files by giving it wtih an absolute path in axxb.py, then please make sure you have set a variable and exported it in your tool_dependencies.xml. That way, you can use the variable that you have set in axxb.xml and pass it to your axxb.py. Thus, you will not encounter error message saying that Galaxy cannot find some specific files after installing packages through ToolShed. Here is an example to show how you can achieve it. (Using peakranger as an example)
	
	 I. In tool_dependencies.xml, it sets environment variable "SCRIPT_PATH" equal to $REPOSITORY_INSTALL_DIR (It is the variable generated by Galaxy's parser)

	 II. It calls $SCRIPT_PATH in ranger_wrapper.xml (axxb.xml). On line 3, it sets the requirements, and on line 7, it passes the $SCRIPT_PATH to ranger_wrapper.py (axxb.py). 

	 III. ranger_wrapper.py will handle the variable argument. On line 18, it sets the variable (script_path) . Line 55, it uses the variable and again on line 73.

Contacts
--------------

This documentation is served as a reference. Hope it is helpful to some of the users!

If there is any error in the docutment, or you have questions and comments, please don't hesitate and send us an email to **modENCODE DCC** at help@modencode.org
